<!DOCTYPE html>
<html lang="et">
<head>
    <title>Kogu kogumik</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='meediariiul.css') }}">
    <script>
        function toggleDetails(id) {
            const box = document.getElementById("details-" + id);
            box.style.display = (box.style.display === "table-row") ? "none" : "table-row";
        }
    </script>
</head>

<body>

<header>
  <div class="logo-title">
    <img src="{{ url_for('static', filename='pildid/books.png') }}" width="60" alt="Logo">
    <h1>MeediaRiiul</h1>
  </div>

  <nav class="menÃ¼Ã¼">
    <a href="{{ url_for('avaleht') }}">AVALEHT</a>
    <a class="active" href="{{ url_for('kogu') }}">KOGU KOGUMIK</a>
    <a href="{{ url_for('lisa') }}">LISA UUS TEOS</a>
    <a href="{{ url_for('soovid') }}">SOOVINIMEKIRI</a>
    <a href="{{ url_for('statistika') }}">STATISTIKA</a>
    <a href="{{ url_for('profiil') }}">PROFIIL</a>

    {% if current_user.is_authenticated %}
    <div class="kasutaja-nurk">
      <span>{{ current_user.kasutajanimi }}</span>
      <a class="logout" href="{{ url_for('logout') }}">LOGI VÃ„LJA</a>
    </div>
    {% endif %}
  </nav>
</header>

<h2>KOGU KOGUMIK</h2>

<form method="GET" action="{{ url_for('kogu') }}" class="search-container">
    <input type="text" name="otsi"
           placeholder="Otsi pealkirja, autorit vÃµi Å¾anrit..."
           value="{{ request.args.get('otsi', '') }}"
           class="otsinguvÃ¤li">

    <input type="hidden" name="tÃ¼Ã¼p" value="{{ tÃ¼Ã¼p_filter }}">
    <input type="hidden" name="staatus" value="{{ staatus_filter }}">
    <input type="hidden" name="hinne" value="{{ hinne_filter }}">
    <input type="hidden" name="zanr" value="{{ zanr_filter }}">

    

    <button type="submit" class="otsi-btn">Otsi</button>

</form>
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-wrapper">
      {% for category, message in messages %}
        <div class="flash-box {{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}
<br>

<div class="filter-buttons">
  <a href="{{ url_for('kogu', tÃ¼Ã¼p='kÃµik', staatus=staatus_filter, hinne=hinne_filter, zanr=zanr_filter) }}" class="filter {{ 'active' if tÃ¼Ã¼p_filter=='kÃµik' }}">KÃµik</a>
  <a href="{{ url_for('kogu', tÃ¼Ã¼p='raamat', staatus=staatus_filter, hinne=hinne_filter, zanr=zanr_filter) }}" class="filter {{ 'active' if tÃ¼Ã¼p_filter=='raamat' }}">ðŸ“š Raamatud</a>
  <a href="{{ url_for('kogu', tÃ¼Ã¼p='film', staatus=staatus_filter, hinne=hinne_filter, zanr=zanr_filter) }}" class="filter {{ 'active' if tÃ¼Ã¼p_filter=='film' }}">ðŸŽ¬ Filmid</a>
  <a href="{{ url_for('kogu', tÃ¼Ã¼p='sari', staatus=staatus_filter, hinne=hinne_filter, zanr=zanr_filter) }}" class="filter {{ 'active' if tÃ¼Ã¼p_filter=='sari' }}">ðŸ“º Sarjad</a>
</div>

{% if total_pages > 1 %}
<div class="pagination">
  {% if page > 1 %}
    <a class="pag-btn" href="{{ url_for('kogu', page=page-1, tÃ¼Ã¼p=tÃ¼Ã¼p_filter, staatus=staatus_filter, hinne=hinne_filter, zanr=zanr_filter, sort=sort_col, dir=sort_dir) }}">â€¹ Eelmine</a>
  {% endif %}

  {% for i in range(1, total_pages + 1) %}
    <a class="pag-btn {% if i == page %}active{% endif %}"
       href="{{ url_for('kogu', page=i, tÃ¼Ã¼p=tÃ¼Ã¼p_filter, staatus=staatus_filter, hinne=hinne_filter, zanr=zanr_filter, sort=sort_col, dir=sort_dir) }}">{{ i }}</a>
  {% endfor %}

  {% if page < total_pages %}
    <a class="pag-btn" href="{{ url_for('kogu', page=page+1, tÃ¼Ã¼p=tÃ¼Ã¼p_filter, staatus=staatus_filter, hinne=hinne_filter, zanr=zanr_filter, sort=sort_col, dir=sort_dir) }}">JÃ¤rgmine â€º</a>
  {% endif %}
</div>
{% endif %}

<div class="tabelikarp">
<table class="ilus-tabel">
<thead>
<tr>
  <th>
  <a class="sortable" href="{{ url_for(
        'kogu', tÃ¼Ã¼p=tÃ¼Ã¼p_filter, staatus=staatus_filter,
        hinne=hinne_filter, zanr=zanr_filter,
        sort='pealkiri',
        dir='desc' if sort_col=='pealkiri' and sort_dir=='asc' else 'asc',
        page=1
  ) }}">
    Pealkiri
    {% if sort_col == 'pealkiri' %}
        <span class="sort-icon">{{ 'â†‘' if sort_dir=='asc' else 'â†“' }}</span>
    {% endif %}
  </a>
</th>


  <th>TÃ¼Ã¼p</th>

  <th>
  <div class="dropdown header-flex">
      <span class="header-label">Å½anr</span>
      <button class="dropbtn-small">â˜°</button>

      <div class="dropdown-content">
          <a href="{{ url_for('kogu', sort='Å¾anr', dir='asc') }}">A â†’ Z</a>
          <a href="{{ url_for('kogu', sort='Å¾anr', dir='desc') }}">Z â†’ A</a>
      </div>
  </div>
</th>





  <th>
    <div class="header-flex dropdown">
        <span class="header-label">
            <a class="sortable"
               href="{{ url_for(
                    'kogu',
                    tÃ¼Ã¼p=tÃ¼Ã¼p_filter,
                    staatus=staatus_filter,
                    hinne=hinne_filter,
                    zanr=zanr_filter,
                    sort='staatus',
                    dir='desc' if sort_col=='staatus' and sort_dir=='asc' else 'asc',
                    page=1
               ) }}">
                Staatus
                {% if sort_col == 'staatus' %}
                    <span class="sort-icon">{{ 'â†‘' if sort_dir=='asc' else 'â†“' }}</span>
                {% endif %}
            </a>
        </span>

        <button class="dropbtn-small">â˜°</button>

        <div class="dropdown-content">
            <a href="{{ url_for('kogu', tÃ¼Ã¼p=tÃ¼Ã¼p_filter, staatus='kÃµik', hinne=hinne_filter, zanr=zanr_filter, sort=sort_col, dir=sort_dir) }}">KÃµik</a>
            <a href="{{ url_for('kogu', tÃ¼Ã¼p=tÃ¼Ã¼p_filter, staatus='lopetatud', hinne=hinne_filter, zanr=zanr_filter, sort=sort_col, dir=sort_dir) }}">LÃµpetatud</a>
            <a href="{{ url_for('kogu', tÃ¼Ã¼p=tÃ¼Ã¼p_filter, staatus='pooleli', hinne=hinne_filter, zanr=zanr_filter, sort=sort_col, dir=sort_dir) }}">Pooleli</a>
            <a href="{{ url_for('kogu', tÃ¼Ã¼p=tÃ¼Ã¼p_filter, staatus='soovinimekiri', hinne=hinne_filter, zanr=zanr_filter, sort=sort_col, dir=sort_dir) }}">Soovinimekiri</a>
            <a href="{{ url_for('kogu', tÃ¼Ã¼p=tÃ¼Ã¼p_filter, staatus='peatatud', hinne=hinne_filter, zanr=zanr_filter, sort=sort_col, dir=sort_dir) }}">Peatatud</a>
        </div>
    </div>
</th>



  <th>
  <div class="dropdown header-flex">
      <span class="header-label">Hinne</span>
      <button class="dropbtn-small">â˜°</button>

      <div class="dropdown-content">
          <a href="{{ url_for('kogu', sort='hinne', dir='desc') }}">KÃµrgemad enne</a>
          <a href="{{ url_for('kogu', sort='hinne', dir='asc') }}">Madalamad enne</a>
      </div>
  </div>
</th>






  <th>Autor / ReÅ¾issÃ¶Ã¶r</th>
  <th>KuupÃ¤ev</th>
  <th>Muuda</th>
  <th>Kustuta</th>
</tr>
</thead>

<tbody>
{% for rida in tabel %}
<tr onclick="toggleDetails('{{ rida.id }}')" class="clickable-row">
  <td>{{ rida.pealkiri }}</td>
  <td>{{ rida.meedia_tÃ¼Ã¼p }}</td>
  <td>{{ rida.Å¾anr }}</td>
  <td>{{ rida.staatus }}</td>
  <td>{{ rida.hinne }}</td>
  <td>{{ rida.autor_vÃµi_reÅ¾issÃ¶Ã¶r }}</td>
  <td>{{ rida.kuupÃ¤ev }}</td>
  <td><a class="btn-muuda" href="{{ url_for('muuda', id=rida.id) }}">Muuda</a></td>
  <td><a class="btn-kustuta" href="{{ url_for('kustuta', id=rida.id) }}" onclick="return confirm('Kustutada?')">ðŸ—‘</a></td>
</tr>

<tr id="details-{{ rida.id }}" class="detail-row" style="display:none;">
  <td colspan="9">
    {% if rida.arvamus %}<strong>Arvamus:</strong> {{ rida.arvamus }}<br>{% endif %}
    {% if rida.lisainfo %}<strong>Lisainfo:</strong> {{ rida.lisainfo }}{% endif %}
  </td>
</tr>

{% endfor %}
</tbody>

</table>
</div>

{% if total_pages > 1 %}
<div class="pagination">
  {% if page > 1 %}
    <a class="pag-btn" href="{{ url_for('kogu', page=page-1, tÃ¼Ã¼p=tÃ¼Ã¼p_filter, staatus=staatus_filter, hinne=hinne_filter, zanr=zanr_filter, sort=sort_col, dir=sort_dir) }}">â€¹ Eelmine</a>
  {% endif %}

  {% for i in range(1, total_pages + 1) %}
    <a class="pag-btn {% if i == page %}active{% endif %}"
       href="{{ url_for('kogu', page=i, tÃ¼Ã¼p=tÃ¼Ã¼p_filter, staatus=staatus_filter, hinne=hinne_filter, zanr=zanr_filter, sort=sort_col, dir=sort_dir) }}">{{ i }}</a>
  {% endfor %}

  {% if page < total_pages %}
    <a class="pag-btn" href="{{ url_for('kogu', page=page+1, tÃ¼Ã¼p=tÃ¼Ã¼p_filter, staatus=staatus_filter, hinne=hinne_filter, zanr=zanr_filter, sort=sort_col, dir=sort_dir) }}">JÃ¤rgmine â€º</a>
  {% endif %}
</div>
{% endif %}

<script>
  setTimeout(() => {
    document.querySelectorAll('.flash-box').forEach(box => {
      box.classList.add('hide');
      setTimeout(() => box.remove(), 600); // eemaldab DOM-ist
    });
  }, 3000);
</script>


</body>
</html>










